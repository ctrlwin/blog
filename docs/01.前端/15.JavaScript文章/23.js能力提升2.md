---
title: jsèƒ½åŠ›æå‡2
date: 2021-05-31 17:05:38
permalink: /pages/821694/
categories:
  - å‰ç«¯
  - JavaScriptæ–‡ç« 
tags:
  - 
---
## ['1', '2', '3'].map(parseInt) what & why

[åŸæ–‡é“¾æ¥](https://www.muyiy.cn/question/js/2.html)

ä¸‹é¢ğŸŒ°è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼š

```js
['10','10','10','10','10'].map(parseInt);
```

###  parseInt

`parseInt()` å‡½æ•°è§£æä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæŒ‡å®šåŸºæ•°çš„æ•´æ•° ã€‚

```js
const intValue = parseInt(string[, radix]);
```

`string` è¦è¢«è§£æçš„å€¼ã€‚å¦‚æœå‚æ•°ä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ™å°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²(ä½¿ç”¨ ToString æŠ½è±¡æ“ä½œ)ã€‚å­—ç¬¦ä¸²å¼€å¤´çš„ç©ºç™½ç¬¦å°†ä¼šè¢«å¿½ç•¥ã€‚

`radix` ä¸€ä¸ªä»‹äº2å’Œ36ä¹‹é—´çš„æ•´æ•°(æ•°å­¦ç³»ç»Ÿçš„åŸºç¡€)ï¼Œè¡¨ç¤ºä¸Šè¿°å­—ç¬¦ä¸²çš„åŸºæ•°ã€‚é»˜è®¤ä¸º10ã€‚ `è¿”å›å€¼` è¿”å›ä¸€ä¸ªæ•´æ•°æˆ–NaN

```js
parseInt(100); // 100
parseInt(100, 10); // 100
parseInt(100, 2); // 4 -> å°†åŸºæ•° 2 ä¸­çš„ 100 è½¬æ¢ä¸ºåŸºæ•° 10
```

**æ³¨æ„ï¼š** åœ¨`radix`ä¸º undefinedï¼Œæˆ–è€…`radix`ä¸º 0 æˆ–è€…æ²¡æœ‰æŒ‡å®šçš„æƒ…å†µä¸‹ï¼ŒJavaScript ä½œå¦‚ä¸‹å¤„ç†ï¼š

- å¦‚æœå­—ç¬¦ä¸² string ä»¥"0x"æˆ–è€…"0X"å¼€å¤´, åˆ™åŸºæ•°æ˜¯16 (16è¿›åˆ¶).
- å¦‚æœå­—ç¬¦ä¸² string ä»¥"0"å¼€å¤´, åŸºæ•°æ˜¯8ï¼ˆå…«è¿›åˆ¶ï¼‰æˆ–è€…10ï¼ˆåè¿›åˆ¶ï¼‰ï¼Œé‚£ä¹ˆå…·ä½“æ˜¯å“ªä¸ªåŸºæ•°ç”±å®ç°ç¯å¢ƒå†³å®šã€‚ECMAScript 5 è§„å®šä½¿ç”¨10ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„æµè§ˆå™¨éƒ½éµå¾ªè¿™ä¸ªè§„å®šã€‚å› æ­¤ï¼Œæ°¸è¿œéƒ½è¦æ˜ç¡®ç»™å‡ºradixå‚æ•°çš„å€¼ã€‚
- å¦‚æœå­—ç¬¦ä¸² string ä»¥å…¶å®ƒä»»ä½•å€¼å¼€å¤´ï¼Œåˆ™åŸºæ•°æ˜¯10 (åè¿›åˆ¶)ã€‚

æ›´å¤šè¯¦è§[parseInt | MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/parseInt)

### æ€»ç»“

```js
['1', '2', '3'].map(parseInt)
```

å¯¹äºæ¯ä¸ªè¿­ä»£`map`, `parseInt()`ä¼ é€’ä¸¤ä¸ªå‚æ•°: **å­—ç¬¦ä¸²å’ŒåŸºæ•°**ã€‚ æ‰€ä»¥å®é™…æ‰§è¡Œçš„çš„ä»£ç æ˜¯ï¼š

```js
['1', '2', '3'].map((item, index) => {
	return parseInt(item, index)
})
```

å³è¿”å›çš„å€¼åˆ†åˆ«ä¸ºï¼š

```js
parseInt('1', 0) // 1
parseInt('2', 1) // NaN
parseInt('3', 2) // NaN, 3 ä¸æ˜¯äºŒè¿›åˆ¶
```

æ‰€ä»¥ï¼š

```js
['10','10','10','10','10'].map(parseInt);
// [10, NaN, 2, 3, 4]
```

ç­‰ä»·äº

``` js
['10', '10', '10', '10', '10'].map((item, index) => {
    return parseInt(item,index)
})
```

æ‰€è¿”å›çš„å€¼åˆ†åˆ«ä¸ºï¼š

```js
parseInt('10', 0) // 10
parseInt('10', 1) // NaNï¼Œæ²¡æœ‰1è¿›åˆ¶
parseInt('10', 2) // 2
parseInt('10', 3) // 3
parseInt('10', 4) // 4
```

## åœ¨å¯¹è±¡ä¸­åŠ å…¥æ•°ç»„çš„å±æ€§ï¼Œå¯¹è±¡ä¼šå˜æˆä¸€ä¸ªç±»æ•°ç»„

ä¸‹é¢ğŸŒ°çš„è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ

```js
var obj = {
    '2': 3,
    '3': 4,
    'length': 2,
    'splice': Array.prototype.splice,
    'push': Array.prototype.push
}
obj.push(1)
obj.push(2)
console.log(obj)
```

ç»“æœæ˜¯ï¼š

``` js
Object(4) [empty x 2, 1, 2, splice: f, push f]
	2:1
	3:2
	length:4
	push:f push()
    splice:f splice()
	...
```

### ç±»æ•°ç»„ï¼ˆArrayLikeï¼‰ï¼š

ä¸€ç»„æ•°æ®ï¼Œç”±æ•°ç»„æ¥å­˜ï¼Œä½†æ˜¯å¦‚æœè¦å¯¹è¿™ç»„æ•°æ®è¿›è¡Œæ‰©å±•ï¼Œä¼šå½±å“åˆ°æ•°ç»„åŸå‹ï¼ŒArrayLikeçš„å‡ºç°åˆ™æä¾›äº†ä¸€ä¸ªä¸­é—´æ•°æ®æ¡¥æ¢ï¼ŒArrayLikeæœ‰æ•°ç»„çš„ç‰¹æ€§ï¼Œ ä½†æ˜¯å¯¹ArrayLikeçš„æ‰©å±•å¹¶ä¸ä¼šå½±å“åˆ°åŸç”Ÿçš„æ•°ç»„ã€‚

### pushæ–¹æ³•ï¼š

push æ–¹æ³•æœ‰æ„å…·æœ‰é€šç”¨æ€§ã€‚è¯¥æ–¹æ³•å’Œ call() æˆ– apply() ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå¯åº”ç”¨åœ¨ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ä¸Šã€‚push æ–¹æ³•æ ¹æ® length å±æ€§æ¥å†³å®šä»å“ªé‡Œå¼€å§‹æ’å…¥ç»™å®šçš„å€¼ã€‚å¦‚æœ length ä¸èƒ½è¢«è½¬æˆä¸€ä¸ªæ•°å€¼ï¼Œåˆ™æ’å…¥çš„å…ƒç´ ç´¢å¼•ä¸º 0ï¼ŒåŒ…æ‹¬ length ä¸å­˜åœ¨æ—¶ã€‚å½“ length ä¸å­˜åœ¨æ—¶ï¼Œå°†ä¼šåˆ›å»ºå®ƒã€‚ å”¯ä¸€çš„åŸç”Ÿç±»æ•°ç»„ï¼ˆarray-likeï¼‰å¯¹è±¡æ˜¯ Stringsï¼Œå°½ç®¡å¦‚æ­¤ï¼Œå®ƒä»¬å¹¶ä¸é€‚ç”¨è¯¥æ–¹æ³•ï¼Œå› ä¸ºå­—ç¬¦ä¸²æ˜¯ä¸å¯æ”¹å˜çš„ã€‚

### æ€»ç»“

å¯ä»¥è¯´ï¼Œåœ¨å¯¹è±¡ä¸­åŠ å…¥spliceå’Œlengthå±æ€§åï¼Œè¿™ä¸ªå¯¹è±¡å˜æˆä¸€ä¸ªç±»æ•°ç»„ã€‚

æ‰€ä»¥é¢˜ç›®çš„è§£é‡Šåº”è¯¥æ˜¯ï¼š

1. ä½¿ç”¨ç¬¬ä¸€æ¬¡pushï¼Œobjå¯¹è±¡çš„pushæ–¹æ³•è®¾ç½® `obj[2]=1;obj.length+=1`
2. ä½¿ç”¨ç¬¬äºŒæ¬¡pushï¼Œobjå¯¹è±¡çš„pushæ–¹æ³•è®¾ç½® `obj[3]=2;obj.length+=1` 
3. ä½¿ç”¨console.logè¾“å‡ºçš„æ—¶å€™ï¼Œå› ä¸ºobjå…·æœ‰ length å±æ€§å’Œ splice æ–¹æ³•ï¼Œæ•…å°†å…¶ä½œä¸ºæ•°ç»„è¿›è¡Œæ‰“å° 
4. æ‰“å°æ—¶å› ä¸ºæ•°ç»„æœªè®¾ç½®ä¸‹æ ‡ä¸º 0ã€1 å¤„çš„å€¼ï¼Œæ•…æ‰“å°ä¸ºemptyï¼Œä¸»åŠ¨ è·å– obj[0]çš„å€¼ä¸º undefined

## å…³äºå¯¹è±¡é”®åçš„è½¬æ¢

ä¸‹é¢ğŸŒ°çš„è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ

```js
// example 1
var a={}, b='123', c=123;  
a[b]='b';
a[c]='c';  
console.log(a[b]);

---------------------
// example 2
var a={}, b=Symbol('123'), c=Symbol('123');  
a[b]='b';
a[c]='c';  
console.log(a[b]);

---------------------
// example 3
var a={}, b={key:'123'}, c={key:'456'};  
a[b]='b';
a[c]='c';  
console.log(a[b]);
```

è¿™é¢˜è€ƒå¯Ÿçš„æ˜¯å¯¹è±¡é”®åçš„è½¬æ¢ã€‚

é”®åè½¬æ¢æœ‰ä»¥ä¸‹è§„åˆ™ï¼š

* å¯¹è±¡çš„é”®ååªèƒ½æ˜¯å­—ç¬¦ä¸²å’ŒSymbolç±»å‹ã€‚
* å…¶å®ƒç±»å‹çš„é”®åä¼šè¢«è½¬æ¢æˆå­—ç¬¦ä¸²ç±»å‹ã€‚
* å¯¹è±¡è½¬å­—ç¬¦ä¸²é»˜è®¤ä¼šè°ƒç”¨toStringæ–¹æ³•ã€‚

æ‰€ä»¥è¾“å‡ºç»“æœä¸ºï¼š

``` js
// example 1
var a={}, b='123', c=123;  
a[b]='b';
a[c]='c'; // c çš„é”®åä¼šè¢«è½¬æ¢ä¸ºå­—ç¬¦ä¸²'123'ï¼Œè¿™é‡Œä¼šæŠŠ b è¦†ç›–æ‰  
console.log(a[b]); // è¾“å‡º c
```



```js
// example 2
var a={}, b=Symbol('123'), c=Symbol('123');  
a[b]='b'; // b çš„é”®åæ˜¯ Symbol ç±»å‹ä¸éœ€è¦è½¬æ¢
a[c]='c'; // c çš„é”®åæ˜¯ Symbol ç±»å‹ä¸éœ€è¦è½¬æ¢ï¼Œå¹¶ä¸”ä»»ä½•ä¸€ä¸ªSymbolç±»å‹çš„å€¼éƒ½æ˜¯ä¸ç›¸ç­‰çš„ï¼Œæ‰€ä»¥ä¸ä¼šè¦†ç›– b 
console.log(a[b]); // è¾“å‡º b
```

``` js
// example 3
var a={}, b={key:'123'}, c={key:'456'};  
a[b]='b'; // b çš„é”®åæ˜¯å¯¹è±¡ç±»å‹ï¼Œä¼šè°ƒç”¨ toString æ–¹æ³•è½¬æ¢ä¸ºå­—ç¬¦ä¸² [object Object]
a[c]='c'; // åŒä¸Šï¼Œæ‰€ä»¥è¿™é‡Œä¼šæŠŠ b è¦†ç›–æ‰ 
console.log(a[b]); // è¾“å‡º c
```

## inputæ¡†å¦‚ä½•å¤„ç†ä¸­æ–‡è¾“å…¥

[åŸæ–‡é“¾æ¥](https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/129)

çœ‹è¿‡element-uiæ¡†æ¶æºç çš„ç«¥é‹åº”è¯¥éƒ½çŸ¥é“ï¼ˆæˆ‘æ²¡çœ‹è¿‡ï¼‰ï¼Œelement-uiæ˜¯é€šè¿‡ `compositionstart ` &`compositionend` åšçš„ä¸­æ–‡è¾“å…¥å¤„ç†ï¼š

```vue
// ç›¸å…³ä»£ç ï¼š
<input
ref="input"
@compositionstart="handleComposition"
@compositionupdate="handleComposition"
@compositionend="handleComposition"
>
```

è¿™ä¸‰ä¸ªæ–¹æ³•éƒ½æ˜¯åŸç”Ÿçš„æ–¹æ³•ï¼Œè¿™é‡Œç®€è¦è¯´ä¸€ä¸‹è¿™ä¸‰ä¸ªæ–¹æ³•çš„æ‰§è¡Œæµç¨‹ï¼š

è¾“å…¥è‹±æ–‡æ˜¯ä¸ä¼šè§¦å‘è¿™ä¸‰ä¸ªæ–¹æ³•çš„ï¼Œåªæœ‰è¾“å…¥ä¸­æ–‡æ‰å¯ä»¥ã€‚è¿˜åœ¨è¾“å…¥æ‹¼éŸ³æ—¶ï¼ˆæ­¤æ—¶inputè¿˜æ²¡æœ‰å¡«å…¥å†…å®¹ï¼‰ï¼Œä¼šé¦–å…ˆè§¦å‘  `compositionstart` äº‹ä»¶ï¼Œç„¶åæ¯æ‰“ä¸€ä¸ªæ‹¼éŸ³å­—æ¯å°±ä¼šè§¦å‘ä¸€æ¬¡ `compositionupdate` äº‹ä»¶ï¼Œæœ€åå°†è¾“å…¥å¥½çš„ä¸­æ–‡å¡«å…¥inputæ—¶ä¼šè§¦å‘ `compositionend` äº‹ä»¶ã€‚è§¦å‘  `compositionstart` çš„æ—¶å€™ï¼Œæ–‡æœ¬æ¡†ä¼šå¡«å…¥â€œè™šæ‹Ÿæ–‡æœ¬â€ï¼ˆå¾…ç¡®è®¤æ–‡æœ¬ï¼‰ï¼ŒåŒæ—¶è§¦å‘inputäº‹ä»¶ï¼›åœ¨è§¦å‘ `compositionend` æ—¶ï¼Œå°±æ˜¯å¡«å…¥å®é™…å†…å®¹åï¼ˆå·²ç¡®è®¤æ–‡æœ¬ï¼‰ã€‚

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![image](/blog/images/068.png)

æˆ‘ä»¬å¯ä»¥ä»ä¸Šå›¾ä¸­çœ‹åˆ°ï¼š

* è¯†åˆ«åˆ°ä½ å¼€å§‹ä½¿ç”¨ä¸­æ–‡è¾“å…¥æ³•æ—¶è§¦å‘ `compositionstart` äº‹ä»¶
* è¾“å…¥æœªç»“æŸä¸”ä»åœ¨è¾“å…¥ä¸­ä¼šè§¦å‘ `compositionupdate`  äº‹ä»¶
* å½“æˆ‘ä»¬æŒ‰ä¸‹å›è½¦æˆ–æ˜¯é€‰æ‹©äº†å¯¹åº”çš„æ–‡å­—æ’å…¥åˆ°è¾“å…¥æ¡†æ—¶ä»£è¡¨è¾“å…¥å®Œæˆï¼Œæ­¤æ—¶è§¦å‘ `compositionend` äº‹ä»¶

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™å‡ ä¸ªæ–¹æ³•å®ç°è¡¨å•éªŒè¯ï¼Œå¦‚æˆ‘ä»¬å¸Œæœ›ä¸­æ–‡è¾“å…¥å®Œæˆåæ‰éªŒè¯å…¶æœ‰æ•ˆæ€§è€Œä¸æ˜¯æ­£åœ¨è¾“å…¥ä¸­å°±éªŒè¯ã€‚

## å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’æ—¶ï¼Œä¼ é€’çš„æ˜¯å¯¹è±¡åœ°å€

ä¸‹é¢ğŸŒ°çš„è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ

```js
function changeObjProperty(o) {
  o.siteUrl = "http://www.baidu.com"
  o = new Object()
  o.siteUrl = "http://www.google.com"
} 
let webSite = new Object();
changeObjProperty(webSite);
console.log(webSite.siteUrl);
```

ç»“æœæ˜¯ï¼šâ€œhttp://www.baidu.comâ€

å› ä¸ºå¯¹è±¡ä½œä¸ºå‚æ•°æ—¶ï¼Œä¼ é€’è¿›å»çš„æ˜¯è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨åœ°å€ã€‚

```js
function changeObjProperty(o) {
  o.siteUrl = "http://www.baidu.com"  // æ”¹å˜å¯¹åº”åœ°å€å†…çš„å¯¹è±¡å±æ€§å€¼
  o = new Object() // å˜é‡ o è¢«æŒ‡å‘æ–°çš„åœ°å€
  o.siteUrl = "http://www.google.com" // å˜é‡ o çš„æ”¹å˜ä¸æ—§åœ°å€æ— å…³
} 
let webSite = new Object();
changeObjProperty(webSite);
console.log(webSite.siteUrl);
```

## å…³äºå‡½æ•°çš„æ‰§è¡Œé¡ºåº

```js
function Foo() {
    Foo.a = function() {
        console.log(1)
    }
    this.a = function() {
        console.log(2)
    }
}
// ä»¥ä¸Šåªæ˜¯ Foo çš„æ„å»ºæ–¹æ³•ï¼Œæ²¡æœ‰äº§ç”Ÿå®ä¾‹ï¼Œæ­¤åˆ»ä¹Ÿæ²¡æœ‰æ‰§è¡Œ

Foo.prototype.a = function() {
    console.log(3)
}
// ç°åœ¨åœ¨ Foo ä¸ŠæŒ‚è½½äº†åŸå‹æ–¹æ³• a ï¼Œæ–¹æ³•è¾“å‡ºå€¼ä¸º 3

Foo.a = function() {
    console.log(4)
}
// ç°åœ¨åœ¨ Foo ä¸ŠæŒ‚è½½äº†ç›´æ¥æ–¹æ³• a ï¼Œè¾“å‡ºå€¼ä¸º 4

Foo.a();
// ç«‹åˆ»æ‰§è¡Œäº† Foo ä¸Šçš„ a æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯åˆšåˆšå®šä¹‰çš„ï¼Œæ‰€ä»¥
// # è¾“å‡º 4

let obj = new Foo();
/* è¿™é‡Œè°ƒç”¨äº† Foo çš„æ„å»ºæ–¹æ³•ã€‚Foo çš„æ„å»ºæ–¹æ³•ä¸»è¦åšäº†ä¸¤ä»¶äº‹ï¼š
1. å°†å…¨å±€çš„ Foo ä¸Šçš„ç›´æ¥æ–¹æ³• a æ›¿æ¢ä¸ºä¸€ä¸ªè¾“å‡º 1 çš„æ–¹æ³•ã€‚
2. åœ¨æ–°å¯¹è±¡ä¸ŠæŒ‚è½½ç›´æ¥æ–¹æ³• a ï¼Œè¾“å‡ºå€¼ä¸º 2ã€‚
*/

obj.a();
// å› ä¸ºæœ‰ç›´æ¥æ–¹æ³• a ï¼Œä¸éœ€è¦å»è®¿é—®åŸå‹é“¾ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ˜¯æ„å»ºæ–¹æ³•é‡Œæ‰€å®šä¹‰çš„ this.aï¼Œ
// # è¾“å‡º 2

Foo.a();
// æ„å»ºæ–¹æ³•é‡Œå·²ç»æ›¿æ¢äº†å…¨å±€ Foo ä¸Šçš„ a æ–¹æ³•ï¼Œæ‰€ä»¥
// # è¾“å‡º 1
```

æ‰€ä»¥è¾“å‡ºï¼š4 2 1

## æ“ä½œç¬¦å’Œç±»å‹è½¬æ¢

ä¸‹é¢ğŸŒ°çš„è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ

```js
1 + "1"

2 * "2"

[1, 2] + [2, 1]

"a" + + "b"
```

è§£æï¼š

```js
1 + "1"
// åŠ æ€§æ“ä½œç¬¦ï¼šå¦‚æœåªæœ‰ä¸€ä¸ªæ“ä½œæ•°æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™å°†å¦ä¸€ä¸ªæ“ä½œæ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åå†å°†ä¸¤ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥èµ·æ¥
// æ‰€ä»¥å€¼ä¸ºï¼šâ€œ11â€

2 * "2"
// ä¹˜æ€§æ“ä½œç¬¦ï¼šå¦‚æœæœ‰ä¸€ä¸ªæ“ä½œæ•°ä¸æ˜¯æ•°å€¼ï¼Œåˆ™åœ¨åå°è°ƒç”¨ Number()å°†å…¶è½¬æ¢ä¸ºæ•°å€¼
// æ‰€ä»¥å€¼ä¸ºï¼š4

[1, 2] + [2, 1]
// Javascriptä¸­æ‰€æœ‰å¯¹è±¡åŸºæœ¬éƒ½æ˜¯å…ˆè°ƒç”¨valueOfæ–¹æ³•ï¼Œå¦‚æœä¸æ˜¯æ•°å€¼ï¼Œå†è°ƒç”¨toStringæ–¹æ³•ã€‚
// æ‰€ä»¥ä¸¤ä¸ªæ•°ç»„å¯¹è±¡çš„toStringæ–¹æ³•ç›¸åŠ ï¼Œå€¼ä¸ºï¼š"1,22,1"

"a" + + "b"
// åè¾¹çš„â€œ+â€å°†ä½œä¸ºä¸€å…ƒæ“ä½œç¬¦ï¼Œå¦‚æœæ“ä½œæ•°æ˜¯å­—ç¬¦ä¸²ï¼Œå°†è°ƒç”¨Numberæ–¹æ³•å°†è¯¥æ“ä½œæ•°è½¬ä¸ºæ•°å€¼ï¼Œå¦‚æœæ“ä½œæ•°æ— æ³•è½¬ä¸ºæ•°å€¼ï¼Œåˆ™ä¸ºNaNã€‚
// "a" + + "b"å…¶å®å¯ä»¥ç†è§£ä¸º
//   + "b" -> NaN
// æ‰€ä»¥å€¼ä¸ºï¼š"aNaN"
```

## Promiseï¼Œå®ä»»åŠ¡å’Œå¾®ä»»åŠ¡

æ±‚ä¸‹é¢ä»£ç çš„è¾“å‡ºé¡ºåºå’Œè¾“å‡ºå€¼ï¼Œä¸ºä»€ä¹ˆï¼Ÿ

```js
var date = new Date() 

console.log(1, new Date() - date) 

setTimeout(() => {
    console.log(2, new Date() - date)
}, 500) 

Promise.resolve().then(console.log(3, new Date() - date)) 

while(new Date() - date < 1000) {} 

console.log(4, new Date() - date)
```

æ‰§è¡Œç»“æœä¸ºï¼š

``` js
1 0
3 1
4 1000
2 1000
```

å…ˆæ‰§è¡ŒåŒæ­¥ä»»åŠ¡ï¼Œæ‰€ä»¥1å…ˆæ‰“å°ï¼›

`setTimeout`æ˜¯å®ä»»åŠ¡ï¼Œç­‰å¾…æ‰§è¡Œï¼›

å› ä¸º`Promise.then()`çš„å‚æ•°æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä¸æ˜¯ä¸€ä¸ªå‡½æ•°ä¸”`then`æ˜¯ç«‹å³æ‰§è¡Œçš„ï¼Œæ‰€ä»¥æ‰“å°3ï¼Œéšåå°†`then`æ”¾å…¥å¾®ä»»åŠ¡ä¸­ç­‰å¾…æ‰§è¡Œã€‚å¦‚æœ`then()`ä¸­æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™ä¼šç­‰å¾…åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œåæ‰§è¡Œï¼›

`while`å¾ªç¯æ˜¯åŒæ­¥ä»»åŠ¡ï¼Œä¼šé˜»å¡æ‰§è¡Œï¼Œåœ¨ç­‰å¾…ä¸€ç§’åæ‰“å°4ï¼›

æ­¤æ—¶åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œäº†ï¼Œå¼€å§‹æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡ï¼Œå…ˆå°†`then`å–å‡ºæ¥å¹¶æ‰§è¡Œï¼Œå‘ç°thençš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª`undefined`ï¼Œ`promise`å†…éƒ¨ä¼šåˆ¤æ–­ï¼Œå¦‚æœ`then`çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯æˆåŠŸå›è°ƒå‡½æ•°ï¼Œä¸æ˜¯ä¸€ä¸ªå‚æ•°çš„è¯ï¼Œä¼šè‡ªåŠ¨ç»™ä»–åŒ…è£…æˆä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”å°†`resolve`çš„`value`å€¼é€ä¼ åˆ°ä¸‹ä¸€ä¸ªthené‡Œé¢ã€‚

æœ€åå»æ‰§è¡Œ`setTimeout`ï¼Œæ‰“å°2ã€‚

## ç©ºæ•°ç»„ä½¿ç”¨mapæ–¹æ³•ä¼šå¦‚ä½•ï¼Ÿ

åŸæ–‡é“¾æ¥ï¼š[ä¸€é“jsç¬”è¯•é¢˜ï¼Œ åˆ·æ–°äº†æˆ‘å¯¹mapæ–¹æ³•å‡½æ•°çš„è®¤çŸ¥ï¼Œä½ åšå¯¹äº†å—ï¼Ÿ](https://juejin.cn/post/6921623546636550158#heading-0)

 çœ‹ä¸€ä¸ªğŸŒ°ï¼š

``` js
const array=new Array(5).map(item=>{
    return item={
        name:'1'
    }
});
console.log(array)  // è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ
```

æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š

```js
[empty x 5]
```

æœ¬ä»¥ä¸ºä¼šè¾“å‡ºï¼š

``` js
[{name: '1'}, {name: '1'}, {name: '1'}, {name: '1'}, {name: '1'}];
```

é‚£ä¹ˆä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿ

åŸå› æ˜¯å®ƒä¼šå»éå†æ¯ä¸€é¡¹ï¼Œå¹¶é€šè¿‡key in arrayæ¥åˆ¤æ–­å½“å‰é¡¹æ˜¯å¦ä¸º**empty**ï¼Œå¦‚æœæ˜¯å°±ä¸æ‰§è¡Œåç»­æ“ä½œ

V8çš„æºç ï¼š

``` js
function ArrayMap(f, receiver) {
  CHECK_OBJECT_COERCIBLE(this, "Array.prototype.map");

  // Pull out the length so that modifications to the length in the
  // loop will not affect the looping and side effects are visible.
  var array = TO_OBJECT(this);
  var length = TO_LENGTH(array.length);
  if (!IS_CALLABLE(f)) throw %make_type_error(kCalledNonCallable, f);
  var result = ArraySpeciesCreate(array, length);
  for (var i = 0; i < length; i++) {
    if (i in array) { // åœ¨è¿™é‡Œæ£€æŸ¥å…ƒç´ æ˜¯å¦ä¸ºç©º
      var element = array[i];
      %CreateDataProperty(result, i, %_Call(f, receiver, element, i, array));
    }
  }
  return result;
}
```

